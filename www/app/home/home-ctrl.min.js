angular.module("ionic.metApp").controller("HomeCtrl",function(e,t,n,o,a,r,l,c,u,s,m,g){function d(){var e=new Date,t=e.getHours(),n="";return t>=6&&12>t?n="morning":t>=12&&18>t?n="mid day":t>=18&&(n="night"),n}function h(){var e=new Date,t=e.getHours();return t>=0&&12>t&&(t=(0==t?"12":t)+"am"),t>12&&(t=t-12+"pm"),t}function f(){var e=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],t=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],n=new Date;return[t[n.getDay()],n.getDate(),e[n.getMonth()],n.getFullYear()]}function v(e){var t=new Date,n=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"];return n[t.getDay()+e]}var _=this;t.activeBgImageIndex=0,t.has_images=!1;var p=6e5;m(function(){t.refreshData(),console.log("fetch info and location")},p),o.$on("call_test",function(){t.test()}),t.test=function(){return"LOL"},_.get_uv_index=function(){var n=[];e.get_uv_index(function(e){console.log("UV Index: ");var o=new Date,a=o.getDate()+"."+(o.getMonth()+1)+"."+o.getFullYear();t.hour_of_day=h();for(var i=0;i<e.items.length;i++){var r=e.items[i].uv_date;a==r&&n.push(e.items[i])}if(n.length){t.uv_index=n[n.length-1];var l=Number(t.uv_index.uv_value),i=l.toFixed(0);t.uv_index.uv_value=i,console.log(t.uv_index)}})},_.get_uv_index(),t.w_today=function(){var e="PRESENT",t=angular.element(document.querySelector("#day")),n=angular.element(document.querySelector("#temptemp")),o=angular.element(document.querySelector("#today-temp"));o.text(n.text()),t.text(e)},t.w_tomorrow=function(){var e="TOMORROW",t=angular.element(document.querySelector("#day")),n=angular.element(document.querySelector("#today-temp"));n.text(30),t.text(e)},t.w_nextDay=function(){var e="NEXT DAY",t=angular.element(document.querySelector("#day")),n=angular.element(document.querySelector("#today-temp"));n.text(31),t.text(e)},_.metars=function(){e.get_metar(function(e){var n=e.items;t.current_temp=n[2].value.substring(0,3);var o=[{id:2,icon:"icon ion-thermometer",el:"temp"},{id:3,icon:"icon ion-waterdrop",el:"dew"},{id:4,icon:"icon ion-ios-speedometer-outline",el:"pressure"},{id:5,icon:"icon ion-ios-analytics-outline",el:"winds"},{id:8,icon:"icon ion-ios-cloudy-outline",el:"clouds"},{id:9,icon:"icon ion-umbrella",el:"weather"}];for(_.metars=[],i=0;i<o.length;i++)_.metars.push({id:n[o[i].id].id,label:n[o[i].id].label,station:n[o[i].id].station,value:n[o[i].id].value,icon:o[i].icon,el:o[i].el});console.log("metars temp"),console.log(_.metars)})},_.forecast=function(n){e.get_o_tv(function(e){console.log("outlook tv");var n=e.items[0];t.summary_text=n.textArea1,console.log(e),t.t=v(0),t.tm=v(1),t.nd=v(2),_.th=n.maxTrin24look,_.tl=n.minTrin24look,_.tmh=n.maxTrin48look,_.tml=n.minTrin48look,console.log(t.nd)})},_.getCurrent=function(e,n){a.getAtLocation(e,n).then(function(e){t.current=e.data,_.metars(),_.forecast(),o.$broadcast("scroll.refreshComplete");d();t.today=f(),_.getBackgroundImage(t.current.daily.icon)},function(e){var n="";switch(e.status){case 404:n="No network connection";break;case"The last location provider was disabled":n=e.status+"<br> Try enabling Location services in Settings"}t.showAlert("Unable to get current conditions",n),o.$broadcast("scroll.refreshComplete")})},t.refreshData=function(){r.getLocation().then(function(e){var n=e.coords.latitude,o=e.coords.longitude;r.reverseGeocode(n,o).then(function(e){t.currentLocationString=e}),_.getCurrent(n,o)},function(e){"The last location provider was disabled"==e.message&&(e.message=e.message+"<br> Try enabling Location services in Settings"),t.showAlert("Unable to get current location","Try enabling Location services in Settings"),t.currentLocationString="Unable to get current location:"+e,o.$broadcast("scroll.refreshComplete")})},t.showAlert=function(e,t){s.alert({title:e,template:t})},_.cycleBgImages=function(){n(function(){t.bgImages&&(t.activeBgImage=t.bgImages[t.activeBgImageIndex++%t.bgImages.length])})},this.getBackgroundImage=function(e){t.bgImages;t.has_images?_.cycleBgImages():l.search(e).then(function(e){var n=e.photos,o=[];if(n.photo.length){for(t.bgImages=n.photo,i=0;i<20;i++)o.push({i:t.bgImages[i]});_.cycleBgImages(),t.has_images=!0}},function(e){console.log("Unable to get Flickr images",e)})},t.refreshData(),t.showHomeMenu=function(){g.retain(),t.home_menu_modal?t.home_menu_modal.show():c.fromTemplateUrl("app/home/home_menu.html",function(e){t.home_menu_modal=e,t.home_menu_modal.show()},{animation:"slide-in-up"})},t.closeModal=function(e){t.modal.hide(),"show_home"==e&&t.showHomeMenu()},t.$on("modal.hidden",function(){g.release()}),t.uv_modalOpen=function(){g.retain(),t.modal.hide(),t.uv_modal?t.uv_modal.show():c.fromTemplateUrl("app/home/uv_modal.html",function(e){t.uv_modal=e,t.uv_modal.show()},{animation:"slide-in-up"})}}).controller("SettingsCtrl",function(e,t){e.setings=t.getSettings(),e.$watch("settings",function(e){t.save()},!0),e.closeSettings=function(){e.modal.hide(),t.save()},e.changeCurrentTemp=function(e){t.set("tempUnits",e),t.save(e)}});