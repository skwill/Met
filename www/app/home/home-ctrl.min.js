angular.module("ionic.metApp").controller("HomeCtrl",function(t,e,n,o,r,i,s,a,c){function u(){var t=new Date,e=t.getHours(),n="";return e>=6&&12>e?n="morning":e>=12&&18>e?n="mid day":e>=18&&(n="night"),n}var l=this;c.ready(function(){window.StatusBar&&StatusBar.hide()}),e.activeBgImageIndex=0,e.showSettings=function(){e.settingsModal?e.settingsModal.show():a.fromTemplateUrl("settings.html",function(t){e.settingsModal=t,e.settingsModal.show()},{animation:"slide-in-up"})},this.getCurrent=function(t,n,i){r.getAtLocation(t,n).then(function(r){e.current=r.data,console.log("Got Current",e.current),o.$broadcast("scroll.refreshComplete");var i=u();l.getBackgroundImage(t,n,e.current.currently.summary+", "+e.current.daily.icon+", hd, "+i)},function(t){alert("Unable to get current conditinos"),console.log(t)})},e.refreshData=function(){i.getLocation().then(function(t){var n=t.coords.latitude,o=t.coords.longitude;i.reverseGeocode(n,o).then(function(t){e.currentLocationString=t}),l.getCurrent(n,o)},function(t){e.currentLocationString="Unable to get current location:"+t})},this.cycleBgImages=function(){n(function(){e.bgImages&&(e.activeBgImage=e.bgImages[e.activeBgImageIndex++%e.bgImages.length])})},this.getBackgroundImage=function(t,n,o){s.search(o,t,n).then(function(t){var n=t.photos;n.photo.length&&(e.bgImages=n.photo,l.cycleBgImages())},function(t){console.log("Unable to get Flickr images",t)})},e.refreshData(),e.yForecast=function(){t.yahooForecast(function(t){console.log(t),l.condition=t.query.results.channel.item.condition,l.threeDay=t.query.results.channel.item.forecast,l.location=t.query.results.channel.location.city,l.pubDate=t.query.results.channel.item.pubDate,l.title=t.query.results.channel.item.title,l.sunrise=t.query.results.channel.astronomy.sunrise,l.sunset=t.query.results.channel.astronomy.sunset})}}).controller("SettingsCtrl",function(t,e){t.setings=e.getSettings(),t.$watch("settings",function(t){e.save()},!0),t.closeSettings=function(){t.modal.hide()}});