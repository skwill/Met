angular.module("ionic.metApp").controller("HomeCtrl",function(t,e,n,o,r,a,i,c,s){function u(){var t=new Date,e=t.getHours(),n="";return e>=6&&12>e?n="morning":e>=12&&18>e?n="mid day":e>=18&&(n="night"),n}function l(t){var e=new Date(1e3*t),n=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],o=e.getFullYear(),r=n[e.getMonth()],a=e.getDate(),i=e.getHours(),c=e.getMinutes(),s=e.getSeconds(),u=a+" "+r+" "+o+" "+i+":"+c+":"+s;return u}var g=this;s.ready(function(){window.StatusBar&&StatusBar.hide()}),e.activeBgImageIndex=0,e.showSettings=function(){e.settingsModal?e.settingsModal.show():c.fromTemplateUrl("settings.html",function(t){e.settingsModal=t,e.settingsModal.show()},{animation:"slide-in-up"})},this.getCurrent=function(t,n,a){r.getAtLocation(t,n).then(function(r){e.current=r.data,console.log("Got Current",e.current),o.$broadcast("scroll.refreshComplete");var a=u(),i=l(e.current.currently.time);e.time=i,console.log(i),g.getBackgroundImage(t,n,e.current.currently.summary+", "+e.current.daily.icon+", hq, trinidad, "+a)},function(t){alert("Unable to get current conditinos"),console.log(t)})},e.refreshData=function(){a.getLocation().then(function(t){var n=t.coords.latitude,o=t.coords.longitude;a.reverseGeocode(n,o).then(function(t){e.currentLocationString=t}),g.getCurrent(n,o)},function(t){e.currentLocationString="Unable to get current location:"+t})},this.cycleBgImages=function(){n(function(){e.bgImages&&(e.activeBgImage=e.bgImages[e.activeBgImageIndex++%e.bgImages.length])})},this.getBackgroundImage=function(t,n,o){i.search(o,t,n).then(function(t){var n=t.photos;n.photo.length&&(e.bgImages=n.photo,g.cycleBgImages())},function(t){console.log("Unable to get Flickr images",t)})},e.refreshData(),e.yForecast=function(){t.yahooForecast(function(t){console.log(t),g.condition=t.query.results.channel.item.condition,g.threeDay=t.query.results.channel.item.forecast,g.location=t.query.results.channel.location.city,g.pubDate=t.query.results.channel.item.pubDate,g.title=t.query.results.channel.item.title,g.sunrise=t.query.results.channel.astronomy.sunrise,g.sunset=t.query.results.channel.astronomy.sunset})}}).controller("SettingsCtrl",function(t,e){t.setings=e.getSettings(),t.$watch("settings",function(t){e.save()},!0),t.closeSettings=function(){t.modal.hide()}});