angular.module("ionic.metApp").controller("HomeCtrl",function(t,e,n,o,r,a,c,i,s){function u(){var t=new Date,e=t.getHours(),n="";return e>=6&&12>e?n="morning":e>=12&&18>e?n="mid day":e>=18&&(n="night"),n}function g(t){var e=new Date(1e3*t),n=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],o=e.getFullYear(),r=n[e.getMonth()],a=e.getDate(),c=e.getHours(),i=e.getMinutes(),s=e.getSeconds(),u=a+" "+r+" "+o+" "+c+":"+i+":"+s;return u}var l=this;s.ready(function(){window.StatusBar&&StatusBar.hide()}),e.activeBgImageIndex=0,e.showSettings=function(){e.settingsModal?e.settingsModal.show():i.fromTemplateUrl("settings.html",function(t){e.settingsModal=t,e.settingsModal.show()},{animation:"scale-in"})},this.getCurrent=function(t,n,a){r.getAtLocation(t,n).then(function(r){e.current=r.data,console.log("Got Current",e.current),o.$broadcast("scroll.refreshComplete");var a=u(),c=g(e.current.currently.time);e.time=c,console.log(c),l.getBackgroundImage(t,n,e.current.currently.summary+", "+e.current.daily.icon+", hq, trinidad, "+a)},function(t){alert("Unable to get current conditinos"),console.log(t)})},e.refreshData=function(){a.getLocation().then(function(t){var n=t.coords.latitude,o=t.coords.longitude;a.reverseGeocode(n,o).then(function(t){e.currentLocationString=t}),l.getCurrent(n,o)},function(t){e.currentLocationString="Unable to get current location:"+t})},this.cycleBgImages=function(){n(function(){e.bgImages&&(e.activeBgImage=e.bgImages[e.activeBgImageIndex++%e.bgImages.length])})},this.getBackgroundImage=function(t,n,o){c.search(o,t,n).then(function(t){var n=t.photos;n.photo.length&&(e.bgImages=n.photo,l.cycleBgImages())},function(t){console.log("Unable to get Flickr images",t)})},e.refreshData(),l.getForecast=function(){t.get_forecast(function(t){console.log(t)})},l.getForecast(),e.yForecast=function(){t.yahooForecast(function(t){console.log(t),l.condition=t.query.results.channel.item.condition,l.threeDay=t.query.results.channel.item.forecast,l.location=t.query.results.channel.location.city,l.pubDate=t.query.results.channel.item.pubDate,l.title=t.query.results.channel.item.title,l.sunrise=t.query.results.channel.astronomy.sunrise,l.sunset=t.query.results.channel.astronomy.sunset})}}).controller("SettingsCtrl",function(t,e){t.setings=e.getSettings(),t.$watch("settings",function(t){e.save()},!0),t.closeSettings=function(){t.modal.hide()}});