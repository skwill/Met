angular.module("ionic.metApp").controller("HomeCtrl",function(e,t,n,o,i,a,c,l,s,u,d,g,m){t.activeBgImageIndex=0,t.isFlipped=!1;var f=6e5;d(function(){console.log("fetch info and location")},f),o.$on("call_test",function(){t.test()}),t.test=function(){return"LOL"},t.set_due_point=function(e,t){var n=t[e].value,o=/([0-9\.]+)%/g;return(r=o.exec(n))[0]},t.showAlert=function(e,t){u.alert({title:e,template:t})},t.flip=function(e){t.isFlipped=!t.isFlipped,console.debug(t),"Trinidad"==e?o.ref_trin():o.ref_bago()},t.closeModal=function(e){t.modal.hide()},t.$on("modal.hidden",function(){g.release()}),t.uv_modalOpen=function(){g.retain(),t.uv_modal?t.uv_modal.show():l.fromTemplateUrl("app/home/uv_modal.html",function(e){t.uv_modal=e,t.uv_modal.show()},{animation:"slide-in-up"})},t.timeOfDay=function(){var e=new Date,t=e.getHours(),n="";return t>=6&&12>t?n="morning":t>=12&&18>t?n="mid day":t>=18&&(n="night"),n},t.hourOfDay=function(){var e=new Date,t=e.getHours();return t>=0&&12>=t&&(t=(0==t?"12":t)+"am"),t>12&&(t=t-12+"pm"),t},t.my_date=function(){var e=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],t=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],n=new Date;return[t[n.getDay()],n.getDate(),e[n.getMonth()],n.getFullYear()]},t.day_string=function(e){var t=new Date,n=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"];return n[t.getDay()+e]},t.convertTimestamp=function(e){var t=new Date(1e3*e),n=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],o=t.getFullYear(),i=n[t.getMonth()],a=t.getDate(),r=t.getHours(),c=t.getMinutes(),l=t.getSeconds(),s=a+" "+i+" "+o+" "+r+":"+c+":"+l;return s}}).directive("dayIcon",function(e){return{restrict:"E",replace:!0,templateUrl:"app/home/svg/icon-sunny.html",link:function(e,t,n){}}}).controller("TrinCtrl",function(e,t,n,o,a,r,c,l,s,u,d,g,m){var f=this;o.ref_trin=function(){f.refreshData()},f.refreshData=function(){r.getLocation().then(function(e){var n=e.coords.latitude,o=e.coords.longitude;r.reverseGeocode(n,o).then(function(e){t.currentLocationString=e,t.country=t.currentLocationString.indexOf("Tobago")>-1?"Tobago":"Trinidad",f.getCurrent(n,o),f.get_uv_index(),f.metars_trin(),f.trin_3day()})},function(e){"The last location provider was disabled"==e.message&&(e.message=e.message+"<br> Try enabling Location services in Settings"),t.showAlert("Unable to get current location","Try enabling Location services in Settings"),t.currentLocationString="Unable to get current location:"+e,o.$broadcast("scroll.refreshComplete")})},f.getCurrent=function(e,n){a.getAtLocation(e,n).then(function(e){t.current=e.data,o.$broadcast("scroll.refreshComplete");t.timeOfDay();t.today=t.my_date(),console.log("currently",t.current),f.getBackgroundImage(t.current.currently.summary+", Trinidad")},function(e){var n="";switch(e.status){case 404:n="No network connection";break;case"The last location provider was disabled":n=e.status+"<br> Try enabling Location services in Settings"}t.showAlert("Unable to get current conditions",n),o.$broadcast("scroll.refreshComplete")})},f.cycleBgImages=function(){n(function(){t.bgImages&&(t.activeBgImage=t.bgImages[t.activeBgImageIndex++%t.bgImages.length+3])})},this.getBackgroundImage=function(e){c.search(e).then(function(e){var n=e.photos;t.bgImages=n.photo,f.cycleBgImages()},function(e){console.log("Unable to get Flickr images",e)})},f.get_uv_index=function(){var n=[],o=["c1","c2","c3","c4","c5","c6","c7","c8","c9","c10","c11"];e.get_uv_index(function(e){console.log("UV Index: ");var i=new Date,a=i.getDate()+"."+(i.getMonth()+1)+"."+i.getFullYear();t.hour_of_day=t.hourOfDay();for(var r=0;r<e.items.length;r++){var c=e.items[r].uv_date.trim();a==c&&n.push(e.items[r])}if(n.length){t.uv_index=n[n.length-1];var l=Number(t.uv_index.uv_value),r=l.toFixed(0);t.uv_index.uv_value=r,console.log(t.uv_index);var s=0==r||1==r?0:11==r||r>11?10:r-1;t.uv_color=o[s],t.$watch("uv_color",function(){var e=document.getElementById("uv-index");e.className=e.className+" "+t.uv_color,console.log("uv color value",t.uv_color,s,r),console.log("watch on uv_value updated")})}else{var u=[{uv_value:0}],d=document.getElementById("uv-index");t.uv_index=u[0],d.className=d.className+" c1"}})},f.metars_trin=function(){e.get_metar(function(e){var n=e.items;t.current_temp_trin=n[2].value.substring(0,3),t.dew_point_trin=t.set_due_point(3,n);var o=[{id:0,icon:"icon ion-ios-location-outline",el:"met-loc"},{id:2,icon:"icon ion-thermometer",el:"temp"},{id:3,icon:"icon ion-waterdrop",el:"dew"},{id:4,icon:"icon ion-ios-speedometer-outline",el:"pressure"},{id:5,icon:"icon ion-ios-analytics-outline",el:"winds"},{id:8,icon:"icon ion-ios-cloudy-outline",el:"clouds"}];for(t.summary_text_trin=n[1].value.indexOf("NOSIG")>-1?"Clear "+t.timeOfDay():"",f.mdata=[],i=0;i<o.length;i++)f.mdata.push({id:n[o[i].id].id,label:n[o[i].id].label,station:n[o[i].id].station,value:n[o[i].id].value,icon:o[i].icon,el:o[i].el})})},t.showMetarsTrin=function(){g.retain(),t.mettrin_modal?t.mettrin_modal.show():l.fromTemplateUrl("app/home/metars-trin.html",function(e){t.mettrin_modal=e,t.mettrin_modal.show()},{animation:"slide-in-up"})},f.trin_3day=function(n){e.get_o_tv(function(e){var n=e.items[0];t.t=t.day_string(0),t.tm=t.day_string(1),t.nd=t.day_string(2),f.max24=n.maxTrin24look,f.min24=n.minTrin24look,f.max48=n.maxTrin48look,f.min48=n.minTrin48look}),e.get_forecast(function(e){var n=e.items[0];t.fcast=n.imageTrin})},f.refreshData()}).controller("BagoCtrl",function(e,t,n,o,a,r,c,l,s,u,d,g,m){var f=this;o.ref_bago=function(){f.refreshData()},f.refreshData=function(){r.getLocation().then(function(e){var n=e.coords.latitude,o=e.coords.longitude;r.reverseGeocode(n,o).then(function(e){t.currentLocationString=e,f.getCurrent(n,o),f.metars_bago(),f.bago_3day(),f.set_time_bubble()})},function(e){"The last location provider was disabled"==e.message&&(e.message=e.message+"<br> Try enabling Location services in Settings"),t.showAlert("Unable to get current location","Try enabling Location services in Settings"),t.currentLocationString="Unable to get current location:"+e,o.$broadcast("scroll.refreshComplete")})},f.getCurrent=function(e,n){a.getAtLocation(e,n).then(function(e){t.current=e.data,o.$broadcast("scroll.refreshComplete");t.timeOfDay();t.today=t.my_date(),console.log("currently",t.current),f.getBackgroundImage(t.current.currently.summary+", Tobago")},function(e){var n="";switch(e.status){case 404:n="No network connection";break;case"The last location provider was disabled":n=e.status+"<br> Try enabling Location services in Settings"}t.showAlert("Unable to get current conditions",n),o.$broadcast("scroll.refreshComplete")})},f.cycleBgImages=function(){n(function(){t.bgImages&&(t.activeBgImage=t.bgImages[t.activeBgImageIndex++%t.bgImages.length])})},this.getBackgroundImage=function(e){c.search(e).then(function(e){var n=e.photos;t.bgImages=n.photo,f.cycleBgImages()},function(e){console.log("Unable to get Flickr images",e)})},f.metars_bago=function(){e.get_metar(function(e){var n=e.items;t.current_temp=n[11].value.substring(0,3),t.dew_point=t.set_due_point(12,n),t.summary_text=n[10].value.indexOf("NOSIG")>-1?"Clear "+t.timeOfDay():n[19].value;var o=[{id:10,icon:"icon ion-ios-location-outline",el:"met-loc"},{id:11,icon:"icon ion-thermometer",el:"temp"},{id:12,icon:"icon ion-waterdrop",el:"dew"},{id:13,icon:"icon ion-ios-speedometer-outline",el:"pressure"},{id:14,icon:"icon ion-ios-analytics-outline",el:"winds"},{id:17,icon:"icon ion-ios-cloudy-outline",el:"clouds"},{id:19,icon:"icon ion-umbrella",el:"weather"}];for(f.mdatab=null,f.mdatab=[],i=0;i<o.length;i++)f.mdatab.push({id:n[o[i].id].id,label:n[o[i].id].label,station:n[o[i].id].station,value:n[o[i].id].value,icon:o[i].icon,el:o[i].el})})},f.set_time_bubble=function(){{var e=new Date;e.getDate()+"."+(e.getMonth()+1)+"."+e.getFullYear()}t.hour_of_day=t.hourOfDay()},t.showMetarsBago=function(){g.retain(),t.metbago_modal?t.metbago_modal.show():l.fromTemplateUrl("app/home/metars-bago.html",function(e){t.metbago_modal=e,t.metbago_modal.show()},{animation:"slide-in-up"})},f.bago_3day=function(n){e.get_o_tv(function(e){var n=e.items[0];t.t=t.day_string(0),t.tm=t.day_string(1),t.nd=t.day_string(2),f.max24=n.maxTbo24look,f.min24=n.minTbo24look,f.max48=n.maxTob48look,f.min48=n.minTob48look}),e.get_forecast(function(e){var n=e.items[0];t.fcast=n.imagebago})},f.refreshData()});