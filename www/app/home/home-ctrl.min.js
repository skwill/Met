angular.module("ionic.metApp").controller("HomeCtrl",function(t,e,n,o,a,c,s,u,l,m,d,f,g,h,_){e.activeBgImageIndex=0,e.isFlipped=!1,setTimeout(function(){"Tobago"==o.c&&e.flip("Tobago")},1e3),e.set_due_point=function(t,e){var n=e[t].value,o=/([0-9\.]+)%/g;return(r=o.exec(n))[0]},e.cTemp=function(t){var n="";return(29>t&&"night"!=e.timeOfDay()||23>t&&"night"==e.timeOfDay)&&(n="cool "+("night"!=e.timeOfDay()?"day":"night")),(t>=29&&31>=t&&"night"!=e.timeOfDay()||t>=23&&26>=t&&"night"==e.timeOfDay())&&(n="warm "+("night"!=e.timeOfDay()?"day":"night")),(t>=32&&34>=t&&"night"!=e.timeOfDay()||t>=27&&29>=t&&"night"==e.timeOfDay())&&(n="hot "+("night"!=e.timeOfDay()?"day":"night")),(t>34&&"night"!=e.timeOfDay()||t>29&&"night"==e.timeOfDay())&&(n="very hot "+("night"!=e.timeOfDay()?"day":"night")),n+" at "},e.cWind=function(t){var n="",o=t;t=t.substring(t.lastIndexOf("(")+1,t.lastIndexOf(";")),t=parseInt(t);var i=(1.15077945*t).toFixed(0)+" MPH",a=o.split("(",1)+"at "+i;return t>=0&&3>=t&&(n="Calm/Still winds coming "+a),t>=4&&10>=t&&(n="Gentle breeze "+a),t>=11&&16>=t&&(n="Moderate breeze "+a),t>=17&&21>=t&&(n="Windy breeze "+a),t>=22&&27>=t&&(n="Strong Winds "+a),t>=28&&33>=t&&(n="Very Strong Winds "+a),t>=34&&62>=t&&(n="Storm Force Winds "+a),t>63&&(n="Hurricane force winds "+a),isNaN(t)&&(n=e.capFLetter(o)),n},e.showAlert=function(t,e){m.alert({title:t,template:e})},e.flip=function(t){e.isFlipped=!e.isFlipped,"Trinidad"==t?o.ref_trin():o.ref_bago()},e.$on("$ionicView.beforeEnter",function(){}),e.$on("$ionicView.enter",function(){}),e.closeModal=function(t){e.modal.hide()},e.myGoBack=function(){h.goBack()},e.$on("modal.hidden",function(){f.release()}),e.timeOfDay=function(){var t=new Date,e=t.getHours(),n="";return e>=0&&12>e?n="morning":e>=12&&17>e?n="mid day":e>=17&&18>e?n="evening":e>=18&&(n="night"),n},e.hourOfDay=function(){var t=new Date,n=t.getHours();return n>=0&&12>=n&&(n=(0==n?"12":n)+":"+e.minuteOfDay()+" am"),n>12&&(n=n-12+":"+e.minuteOfDay()+" pm"),n},e.minuteOfDay=function(){var t=new Date;return t.getMinutes()},e.searchTag=function(){var t=e.timeOfDay(),n=new Date,o=n.getHours();return"morning"==t&&o>5&&7>o&&(t="sunrise"),o>=0&&5>=o&&(t="night"),"morning"==t&&(t="mid day"),t},e.my_date=function(){var t=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],e=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],n=new Date;return[e[n.getDay()],n.getDate(),t[n.getMonth()],n.getFullYear()]},e.day_string=function(t){var e=new Date,n=["Sun","Mon","Tue","Wed","Thu","Fri","Sat","Sun","Mon"];return n[e.getDay()+t]},e.convertTimestamp=function(t){var e=new Date(1e3*t),n=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],o=e.getFullYear(),i=n[e.getMonth()],a=e.getDate(),r=e.getHours(),c=e.getMinutes(),s=e.getSeconds(),u=a+" "+i+" "+o+" "+r+":"+c+":"+s;return u},e.getAverageRGB=function(t,e){var n,o,i,a,r=5,c=document.createElement("canvas"),s=c.getContext&&c.getContext("2d"),u=-4,l={r:0,g:0,b:0},m=0,d=0;if(!s)return defaultrgb;for(i=c.height=t.naturalHeight||t.offsetHeight||t.height,o=c.width=t.naturalWidth||t.offsetWidth||t.width,s.drawImage(t,0,0),n=s.getImageData(0,0,o,i),a=n.data.length;(u+=4*r)<a;)++m,l.r+=n.data[u],l.g+=n.data[u+1],l.b+=n.data[u+2],d+=.34*l.r+.5*l.g+.16*l.b,0!==d&&(d/=2);if(d>.5);else;l.r=~~(l.r/m),l.g=~~(l.g/m),l.b=~~(l.b/m),$(e+".bar, "+e+".d3").css("background-color","rgba("+[l.r,l.g,l.b,.6].join(", ")+")"),$(e+".of1").css("background-color","rgba("+[l.r,l.g,l.b,.9].join(", ")+")")},e.capFLetter=function(t){return t.charAt(0).toUpperCase()+t.slice(1).toLowerCase()},e.is_word_in_string=function(t,e){return new RegExp("\\b"+e+"\\b","i").test(t)},e.inArray=function(t,e){for(i=0;i<e.length;i++)if(e[i]==t)return e[i];return!1},e.metars_cloud=[{code:"FEW",desc:"Clear"},{code:"SCT",desc:"Partly Cloudy"},{code:"BKN",desc:"Mostly Cloudy"},{code:"OVC",desc:"Overcast"},{code:"-RA",desc:"Light Rain"},{code:"-SHRA",desc:"Light Showers"},{code:"RA",desc:"Moderate Rain"},{code:"SHRA",desc:"Moderate Showers"},{code:"+RA",desc:"Heavy Rain"},{code:"+SHRA",desc:"Heavy Showers"},{code:"TS",desc:"Thunder"},{code:"-TSRA",desc:"Light Thundershowers"},{code:"TSRA",desc:"Moderate Thundershowers"},{code:"+THRA",desc:"Heavy Thundershowers"},{code:"FC",desc:"Funnel Cloud"},{code:"BR",desc:"Mist"},{code:"FG",desc:"Fog"},{code:"FU",desc:"Smoke"},{code:"HZ",desc:"Haze"},{code:"SQ",desc:"Squall"},{code:"VCSH",desc:"Rains in various areas"},{code:"CAVOK",desc:"Fair"}],o.go_toForecastHome=function(){g.go("app.forecast_home",{})}}).controller("TrinCtrl",function(t,e,n,o,a,r,c,s,u,l,m,d,f,g,h,_,p,y,v){function b(t,e){return(" "+t.className+" ").indexOf(" "+e+" ")>-1}var w=this;m(function(){e.token=o.token,void 0!=o.token},5e3),e.fcasttrin="night"==e.timeOfDay()?"fair-night":"fair",e.fcastbago="sunny";var T=6e5;m(function(){g.clearCache().then(function(){h.reload(),w.refreshData()}),g.clearHistory()},T),o.ref_trin=function(){w.refreshData()},w.refreshData=function(){w.getCurrent(null,null),w.metars_trin(),w.trin_3day(),n(function(){w.get_uv_index()},100),g.clearCache().then(function(){h.reload()})},w.getCurrent=function(t,n){o.$broadcast("scroll.refreshComplete"),e.today=e.my_date(),w.getBackgroundImage("Trinidad, "+e.searchTag())},w.cycleBgImages=function(){n(function(){e.bgImages&&(e.activeBgImage=e.bgImages[e.activeBgImageIndex++%e.bgImages.length+3],setTimeout(function(){e.getAverageRGB(document.querySelector("#i-trin"),".trin")},2e3))})},this.getBackgroundImage=function(t){c.search(t).then(function(t){var n=t.photos;e.bgImages=n.photo,w.cycleBgImages()},function(t){console.log("Unable to get Flickr images",t)})},w.get_uv_index=function(){var n=[],o=new Date;e.has_index=!0;var i=document.getElementById("uv-index"),a=o.getDate()+"."+(o.getMonth()+1<9?"0"+(o.getMonth()+1):o.getMonth()+1)+"."+o.getFullYear();m(function(){e.hour_of_day=e.hourOfDay()},300);var r=["c1","c2","c3","c4","c5","c6","c7","c8","c9","c10","c11"];if(t.get_uv_index(function(t){for(var o=0;o<t.items.length;o++){var c=t.items[o].uv_date.trim();a==c&&n.push(t.items[o])}if(n.length){e.uv_index=n[n.length-1];var s=Number(e.uv_index.uv_value),o=s.toFixed(0);e.uv_index.uv_value=o;var u=0==o||1==o?0:11==o||o>11?10:o-1;for(e.uv_color=r[u],x=0;x<r.length;x++)b(i,r[x])&&i.classList.remove(r[x]);e.$watch("uv_color",function(){i.className=i.className+"  "+e.uv_color})}}),!n.length){e.has_index=!1;var c=[{uv_value:0}];e.uv_index=c[0],i.className=i.className+" c1"}},w.metars_trin=function(){e.current_temp_trin="Loading..",t.get_metar(function(t){var n=t.items,o=[{id:1,icon:"icon ion-ios-location-outline",el:"met-loc",show:!1,txt:null},{id:2,icon:"icon ion-thermometer",el:null,show:!1,txt:null},{id:3,icon:"icon ion-thermometer",el:"temp",show:!0,txt:null},{id:4,icon:"icon ion-waterdrop",el:"dew",show:!0,txt:null},{id:5,icon:"icon ion-ios-speedometer-outline",el:"pressure",show:!0,txt:null},{id:6,icon:"icon ion-ios-analytics-outline",el:"winds",show:!0,txt:null},{id:7,icon:"icon",el:"weather",show:!1,txt:null},{id:8,icon:"icon",el:"weather",show:!1,txt:null},{id:9,icon:"icon ion-ios-cloudy-outline big-cloud",el:"clouds",show:!0,txt:null},{id:10,icon:"icon ion-umbrella",el:"weather",show:!1}];w.mdata=[];var a=0;for(i=0;i<n.length;i++)"TTPP"==n[i].station&&o[a]&&(w.mdata.push({id:n[a].id,label:n[a].label.replace(":",""),station:n[a].station,value:n[a].value,icon:o[a].icon,el:o[a].el,show:o[a].show}),a++);e.current_temp_trin=w.mdata[2].value.substring(0,3),w.mdata[2].txt="Looks like a "+e.cTemp(Number(e.current_temp_trin)),w.mdata[5].value=e.cWind(w.mdata[5].value),e.dew_point_trin=e.set_due_point(3,w.mdata);var r=[];for(i=0;i<e.metars_cloud.length;i++)w.mdata[1].value.indexOf(e.metars_cloud[i].code)>-1&&r.push(e.metars_cloud[i].code);for(e.cc,i=0;i<r.length;i++)for("FEW"==r[i]&&(e.inArray("SCT",r)||e.inArray("BKN",r)||e.inArray("OVC",r)||(e.cc="FEW")),"SCT"==r[i]&&(e.inArray("BKN",r)||e.inArray("OVC",r)||(e.cc="SCT")),e.inArray("BKN",r)&&(e.cc="BKN"),e.inArray("OVC",r)&&(e.cc="OVC"),x=0;x<e.metars_cloud.length;x++)r[r.length-1]==e.metars_cloud[x].code&&(e.cc=e.metars_cloud[x].code);var c="";for(x=0;x<e.metars_cloud.length;x++)e.cc==e.metars_cloud[x].code&&(c=e.metars_cloud[x].desc,e.summary_text_trin=c);c||(c="Clear",e.summary_text_trin=c);var s=new Date;if(e.fcasttrin="Clear"==c?"clear-"+e.timeOfDay():c,"Clear"==c&&parseInt(s.getHours())>=0&&parseInt(s.getHours())<=5&&(e.fcasttrin="clear-night",console.log("current hour",s.getHours())),w.mdata[1].value.indexOf("NOSIG")>-1){var u=e.summary_text_trin;e.summary_text_trin=e.capFLetter(u)}else e.summary_text_trin=e.capFLetter(w.mdata[9].value.match(/\(([^)]+)\)/)[1]).replace("(","");if(e.summary_text_trin.indexOf("Haze")>-1&&(e.summary_text_trin="Dust, smoke and other dry particles may be in the air"),e.fcasttrin.indexOf("Cloudy")>-1||e.fcasttrin.indexOf("cloudy")>-1){var l="night"==e.timeOfDay()?"-night":"";e.fcasttrin=e.fcasttrin+l,parseInt(s.getHours())>=0&&parseInt(s.getHours())<=5&&(e.fcasttrin=e.fcasttrin+"-night")}})},e.showMetarsTrin=function(){d.retain(),e.mettrin_modal?e.mettrin_modal.show():s.fromTemplateUrl("app/home/metars-trin.html",function(t){e.mettrin_modal=t,e.mettrin_modal.show()},{animation:"slide-in-up"})},w.trin_3day=function(n){e.t="Today",e.tm=e.day_string(1),e.nd=e.day_string(2),t.get_forecast(function(t){var n=t.items[0];w.ftime_trin=n.forecastTime,"05:30PM"==w.ftime_trin&&(y.setObject("530pm_fcast",n),e.t="Tonight",w.th=n.PiarcoFcstMxTemp,w.tl=n.PiarcoFcstMnTemp,w.maxtm=n.TmPiarcoMxTemp,w.mintm=n.TmPiarcoMnTemp,e.trin_tm_icon=n.TmWeatherPiarcoMx?n.TmWeatherPiarcoMx:"sunny",w.max24=n.maxTrin24look,w.min24=n.minTrin24look,e.trin_24_icon=n.wx24?n.wx24:"sunny"),"05:30PM"!=w.ftime_trin&&(w.th=n.PiarcoFcstMxTemp?n.PiarcoFcstMxTemp:" - ",ff=y.getObject("530pm_fcast"),w.tl=ff.TmPiarcoMnTemp?ff.TmPiarcoMnTemp:" - ",w.maxtm=ff.maxTrin24look?ff.maxTrin24look:" - ",w.mintm=ff.minTrin24look?ff.minTrin24look:" - ",e.trin_tm_icon=ff.wx24?ff.wx24:"sunny",w.max24=ff.maxTrin48look?ff.maxTrin48look:" - ",w.min24=ff.minTrin48look?ff.minTrin48look:" - ",e.trin_24_icon=ff.wx48?ff.wx48:"sunny"),e.trin_icon_today=n.imageTrin?n.imageTrin:"sunny",w.sunup=n.sunrise,w.sundown=n.sunset})},w.refreshData()}).controller("BagoCtrl",function(t,e,n,o,a,r,c,s,u,l,m,d,f,g,h,_,p){var y=this;e.fcastbago="sunny";var v=6e5;m(function(){g.clearCache().then(function(){y.refreshData(),h.reload()}),g.clearHistory()},v),o.ref_bago=function(){y.refreshData()},y.refreshData=function(){y.getCurrent(null,null),y.metars_bago(),y.bago_3day(),y.set_time_bubble()},y.getCurrent=function(t,n){e.today=e.my_date(),y.getBackgroundImage("Tobago, "+e.searchTag()),o.$broadcast("scroll.refreshComplete")},y.cycleBgImages=function(){n(function(){e.bgImages&&(e.activeBgImage=e.bgImages[e.activeBgImageIndex++%e.bgImages.length],setTimeout(function(){e.getAverageRGB(document.querySelector("#i-bago"),".bago")},2e3))})},this.getBackgroundImage=function(t){c.search(t).then(function(t){var n=t.photos;e.bgImages=n.photo,y.cycleBgImages()},function(t){console.log("Unable to get Flickr images",t)})},y.metars_bago=function(){e.current_temp="Loading..",t.get_metar(function(t){var n=t.items,o=[{id:9,icon:"icon ion-ios-location-outline",el:"met-loc",show:!1,txt:null},{id:10,icon:"icon ",el:null,show:!1,txt:null},{id:11,icon:"icon ion-thermometer",el:"temp",show:!0,txt:null},{id:12,icon:"icon ion-waterdrop",el:"dew",show:!0,txt:null},{id:13,icon:"icon ion-ios-speedometer-outline",el:"pressure",show:!0,txt:null},{id:14,icon:"icon ion-ios-analytics-outline",el:"winds",show:!0,txt:null},{id:15,icon:"icon ion-thermometer",el:null,show:!1,txt:null},{id:16,icon:"icon ",el:null,show:!1,txt:null},{id:17,icon:"icon ion-ios-cloudy-outline big-cloud",el:"clouds",show:!0,txt:null}];y.mdatab=null,y.mdatab=[];var a=0;for(i=0;i<n.length;i++)"TTCP"==n[i].station&&(y.mdatab.push({id:n[i].id,label:n[i].label,station:n[i].station,value:n[i].value,icon:void 0!=o[a]?o[a].icon:"",el:void 0!=o[a]?o[a].el:"",show:void 0!=o[a]?o[a].show:""}),a++);e.current_temp=y.mdatab[2].value.substring(0,3),y.mdatab[2].txt="Looks like a "+e.cTemp(Number(e.current_temp)),y.mdatab[5].value=e.cWind(y.mdatab[5].value),e.dew_point=e.set_due_point(3,y.mdatab);var r=[];for(i=0;i<e.metars_cloud.length;i++)y.mdatab[1].value.indexOf(e.metars_cloud[i].code)>-1&&r.push(e.metars_cloud[i].code);for(e.cd,i=0;i<r.length;i++)for("FEW"==r[i]&&(e.inArray("SCT",r)||e.inArray("BKN",r)||e.inArray("OVC",r)||(e.cc="FEW")),"SCT"==r[i]&&(e.inArray("BKN",r)||e.inArray("OVC",r)||(e.cc="SCT")),e.inArray("BKN",r)&&(e.cc="BKN"),e.inArray("OVC",r)&&(e.cc="OVC"),x=0;x<e.metars_cloud.length;x++)r[r.length-1]==e.metars_cloud[x].code&&(e.cd=e.metars_cloud[x].code);var c="";for(x=0;x<e.metars_cloud.length;x++)e.cd==e.metars_cloud[x].code&&(c=e.metars_cloud[x].desc,e.summary_text=c);c||(c="Clear",e.summary_text=c);var s=new Date;if(e.fcastbago="Clear"==c?"clear-"+e.timeOfDay():c,"Clear"==c&&parseInt(s.getHours())>=0&&parseInt(s.getHours())<=5&&(e.fcastbago="clear-night"),y.mdatab[1].value.indexOf("NOSIG")>-1){var u=e.summary_text;e.summary_text=e.capFLetter(u)}else e.summary_text=e.capFLetter(y.mdatab[9].value.match(/\(([^)]+)\)/)[1]).replace("(","");if(e.summary_text.indexOf("Haze")>-1&&(e.summary_text="Dust, smoke and other dry particles may be in the air"),e.fcastbago.indexOf("Cloudy")>-1||e.fcastbago.indexOf("cloudy")>-1){var l="night"==e.timeOfDay()?"-night":"";e.fcastbago=e.fcastbago+l,parseInt(s.getHours())>=0&&parseInt(s.getHours())<=5&&(e.fcastbago=e.fcastbago+"-night")}})},y.set_time_bubble=function(){{var t=new Date;t.getDate()+"."+(t.getMonth()+1)+"."+t.getFullYear()}e.hour_of_day=e.hourOfDay()},e.showMetarsBago=function(){d.retain(),e.metbago_modal?e.metbago_modal.show():s.fromTemplateUrl("app/home/metars-bago.html",function(t){e.metbago_modal=t,e.metbago_modal.show()},{animation:"slide-in-up"})},y.bago_3day=function(n){e.t="Today",e.tm=e.day_string(1),e.nd=e.day_string(2),t.get_forecast(function(t){var n=t.items[0];y.ftime_bago=n.forecastTime,"05:30PM"==y.ftime_bago&&(p.setObject("530pm_fcast",n),e.t="Tonight",y.th=n.CrownFcstMxTemp?n.CrownFcstMxTemp:" - ",y.tl=n.CrownFcstMnTemp?n.CrownFcstMnTemp:" - ",y.maxtm=n.TmCrownMxTemp,y.mintm=n.TmCrownMnTemp,e.bago_tm_icon=n.TmWeatherCpMx?n.TmWeatherCpMx:"sunny",y.max24=n.maxTob24look,y.min24=n.minTob24look,e.bago_24_icon=n.wx24cp?n.wx48cp:"sunny"),"05:30PM"!=y.ftime_bago&&(y.th=n.CrownFcstMxTemp?n.CrownFcstMxTemp:" - ",ff=p.getObject("530pm_fcast"),y.tl=ff.TmCrownMnTemp?ff.TmCrownMnTemp:" - ",y.maxtm=ff.maxTob24look,y.mintm=ff.minTob24look,e.bago_tm_icon=ff.wx24cp?ff.wx24cp:"sunny",y.max24=ff.maxTob48look,y.min24=ff.minTob48look,e.bago_24_icon=ff.wx48cp?ff.wx48cp:"sunny"),e.bago_icon_today=n.imagebago})},y.refreshData()}).directive("weatherIconTrin",function(){return{restrict:"E",replace:!0,link:function(t,e,n){t.$watch("fcasttrin",function(){setTimeout(function(){var e=t.fcasttrin.replace(/\s/g,"-").toLowerCase();t.getContentUrl=function(){return"app/home/svg/"+e+".html"}},2e3)})},template:'<div ng-include="getContentUrl()" style="padding-top: 13px; margin-right: -7px;"></div>'}}).directive("weatherIconBago",function(t){return{restrict:"E",link:function(t,e,n){t.$watch("fcastbago",function(){setTimeout(function(){var e=t.fcastbago.replace(/\s/g,"-").toLowerCase();t.getContentUrl=function(){return"app/home/svg/"+e+".html"}},2e3)})},template:'<div ng-include="getContentUrl()" style="padding-top: 13px; margin-right: -7px;"></div>'}}).directive("trinTodayIcon",function(t){return{restrict:"E",link:function(e,n,o){setTimeout(function(){e.$watch("trin_icon_today",function(){var n=(e.trin_icon_today?e.trin_icon_today:"sunny").replace(/\s/g,"-").toLowerCase();console.debug("icon for today",n),e.ti1=function(){return t.trin_icon_ready=!0,"app/home/forecast_icons/"+n+".html"}})},2e3)},template:'<div ng-include="ti1()" class="tti"></div>'}}).directive("trinTomIcon",function(){return{restrict:"E",link:function(t,e,n){setTimeout(function(){t.$watch("trin_tm_icon",function(){var e=(t.trin_tm_icon?t.trin_tm_icon:"sunny").replace(/\s/g,"-").toLowerCase();t.ti2=function(){return"app/home/forecast_icons/"+e+".html"}})},2e3)},template:'<div ng-include="ti2()"></div>'}}).directive("trinNdiIcon",function(){return{restrict:"E",link:function(t,e,n){setTimeout(function(){t.$watch("trin_24_icon",function(){var e=(t.trin_24_icon?t.trin_24_icon:"sunny").replace(/\s/g,"-").toLowerCase();t.ti3=function(){return"app/home/forecast_icons/"+e+".html"}})},2e3)},template:'<div ng-include="ti3()"></div>'}}).directive("bagoTodayIcon",function(){return{restrict:"E",link:function(t,e,n){t.$watch("bago_icon_today",function(){setTimeout(function(){var e=(t.bago_icon_today?t.bago_icon_today:"sunny").replace(/\s/g,"-").toLowerCase();t.bi1=function(){return"app/home/forecast_icons/"+e+".html"}},2e3)})},template:'<div ng-include="bi1()"></div>'}}).directive("bagoTomIcon",function(){return{restrict:"E",link:function(t,e,n){t.$watch("bago_tm_icon",function(){setTimeout(function(){var e=(t.bago_tm_icon?t.bago_tm_icon:"sunny").replace(/\s/g,"-").toLowerCase();t.bi2=function(){return"app/home/forecast_icons/"+e+".html"}},2e3)})},template:'<div ng-include="bi2()"></div>'}}).directive("bagoNdiIcon",function(){return{restrict:"E",link:function(t,e,n){setTimeout(function(){t.$watch("bago_24_icon",function(){var e=(t.bago_24_icon?t.bago_24_icon:"sunny").replace(/\s/g,"-").toLowerCase();t.bi3=function(){return"app/home/forecast_icons/"+e+".html"}})},2e3)},template:'<div ng-include="bi3()"></div>'}});