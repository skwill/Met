angular.module("ionic.metApp").controller("HomeCtrl",function(t,e,n,o,r,s,a,c,i,l){function u(){var t=new Date,e=t.getHours(),n="";return e>=6&&12>e?n="morning":e>=12&&18>e?n="mid day":e>=18&&(n="night"),n}function g(t){var e=new Date(1e3*t),n=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],o=e.getFullYear(),r=n[e.getMonth()],s=e.getDate(),a=e.getHours(),c=e.getMinutes(),i=e.getSeconds(),l=s+" "+r+" "+o+" "+a+":"+c+":"+i;return l}var h=this;e.activeBgImageIndex=0,e.lc="";this.getCurrent=function(t,n){r.getAtLocation(t,n).then(function(r){e.current=r.data,console.log("Got Current",e.current),o.$broadcast("scroll.refreshComplete");var s=u(),a=g(e.current.currently.time);e.time=a,console.log(a),window.localStorage.last_resfrsh=a,e.last_refresh=window.localStorage.getItem("last_refresh"),h.getBackgroundImage(t,n,e.current.currently.summary+", "+e.current.daily.icon+", hq, trinidad, "+s)},function(t){var n="";switch(t.status){case 404:n="No network connection"}e.showAlert("Unable to get current conditions",n),console.log(t),o.$broadcast("scroll.refreshComplete")})},e.refreshData=function(){s.getLocation().then(function(t){var n=t.coords.latitude,o=t.coords.longitude;s.reverseGeocode(n,o).then(function(t){e.currentLocationString=t}),h.getCurrent(n,o)},function(t){e.showAlert("Unable to get current location",t.message),e.currentLocationString="Unable to get current location:"+t,o.$broadcast("scroll.refreshComplete")})},e.showAlert=function(t,e){l.alert({title:t,template:e})},this.cycleBgImages=function(){n(function(){e.bgImages&&(e.activeBgImage=e.bgImages[e.activeBgImageIndex++%e.bgImages.length])})},this.getBackgroundImage=function(t,n,o){a.search(o,t,n).then(function(t){var n=t.photos;n.photo.length&&(e.bgImages=n.photo,h.cycleBgImages())},function(t){console.log("Unable to get Flickr images",t)})},e.refreshData(),h.getForecast=function(){t.get_forecast(function(t){})},h.getForecast(),e.yForecast=function(){t.yahooForecast(function(t){console.log(t),h.condition=t.query.results.channel.item.condition,h.threeDay=t.query.results.channel.item.forecast,h.location=t.query.results.channel.location.city,h.pubDate=t.query.results.channel.item.pubDate,h.title=t.query.results.channel.item.title,h.sunrise=t.query.results.channel.astronomy.sunrise,h.sunset=t.query.results.channel.astronomy.sunset})},e.showSettings=function(){e.settingsModal?e.settingsModal.show():c.fromTemplateUrl("settings.html",function(t){e.settingsModal=t,e.settingsModal.show()},{animation:"scale-in"})}}).controller("SettingsCtrl",function(t,e){t.setings=e.getSettings(),t.$watch("settings",function(t){e.save()},!0),t.closeSettings=function(){t.modal.hide()}});