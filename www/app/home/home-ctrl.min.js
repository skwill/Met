angular.module("ionic.metApp").controller("HomeCtrl",function(e,t,n,o,a,r,c,s,g,u,l){function d(){var e=new Date,t=e.getHours(),n="";return t>=6&&12>t?n="morning":t>=12&&18>t?n="mid day":t>=18&&(n="night"),n}function h(){var e=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],t=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],n=new Date;return[t[n.getDay()],n.getDate(),e[n.getMonth()],n.getFullYear()]}function m(e){var t=new Date(1e3*e),n=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],o=t.getFullYear(),a=n[t.getMonth()],r=t.getDate(),i=t.getHours(),c=t.getMinutes(),s=t.getSeconds(),g=r+" "+a+" "+o+" "+i+":"+c+":"+s;return g}var f=this,v=6e5;l(function(){t.refreshData(),console.log("fetch info and location")},v),o.$on("call_test",function(){t.test()}),t.test=function(){return alert("LOL"),"LOL"},t.activeBgImageIndex=0,t.has_images=!1,f.get_uv_index=function(){e.get_uv_index(function(e){console.log("UV Index: "),console.log(e.items);for(var t=0;t<e.items.length;t++);})},this.getCurrent=function(e,n){a.getAtLocation(e,n).then(function(a){t.current=a.data,o.$broadcast("scroll.refreshComplete");var r=d(),i=h();console.log(i);var c=m(t.current.currently.time);t.time=c,f.getBackgroundImage(e,n,t.current.currently.summary+", "+t.current.daily.icon+", hq, trinidad, "+r)},function(e){var n="";switch(e.status){case 404:n="No network connection"}t.showAlert("Unable to get current conditions",n),o.$broadcast("scroll.refreshComplete")})},t.refreshData=function(){r.getLocation().then(function(e){var n=e.coords.latitude,o=e.coords.longitude;r.reverseGeocode(n,o).then(function(e){t.currentLocationString=e}),f.getCurrent(n,o)},function(e){t.showAlert("Unable to get current location",e.message),t.currentLocationString="Unable to get current location:"+e,o.$broadcast("scroll.refreshComplete")})},t.showAlert=function(e,t){u.alert({title:e,template:t})},this.cycleBgImages=function(){n(function(){t.bgImages&&(t.activeBgImage=t.bgImages[t.activeBgImageIndex++%t.bgImages.length])})},this.getBackgroundImage=function(e,n,o){t.bgImages;t.has_images?f.cycleBgImages():c.search(o,e,n).then(function(e){var n=e.photos,o=[];if(n.photo.length){for(t.bgImages=n.photo,i=0;i<20;i++)o.push({i:t.bgImages[i]});f.cycleBgImages(),t.has_images=!0}},function(e){console.log("Unable to get Flickr images",e)})},t.refreshData(),document.addEventListener("deviceready",function(){}),t.showSettings=function(){t.settingsModal?t.settingsModal.show():s.fromTemplateUrl("settings.html",function(e){t.settingsModal=e,t.settingsModal.show()},{animation:"slide-in-up"})}}).controller("SettingsCtrl",function(e,t){e.setings=t.getSettings(),e.$watch("settings",function(e){t.save()},!0),e.closeSettings=function(){e.modal.hide(),t.save()},e.changeCurrentTemp=function(e){t.set("tempUnits",e),t.save(e)}});