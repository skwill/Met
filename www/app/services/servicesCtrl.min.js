angular.module("ionic.metApp").controller("ServicesCtrl",["Radars","metApi","$scope","$ionicLoading","$timeout","$ionicModal","$cordovaDevice","$ionicPlatform","$cordovaPush","$ionicSlideBoxDelegate","$ionicScrollDelegate",function(t,e,a,i,o,n,l,r,s,d,c){function m(t,e,a){for(x=0;x<t.length;x++){var i=new Image;i.src=t[x],i.style.maxWidth="100%";var o=$(e+(x+1));o.html(i),o.find("img").wrap('<a href="'+t[x]+'" class="swipebox" title="'+a+'"></a>')}}var g=this;a.disableSwipe=function(){d.enableSlide(!1)},g.refresh_all_a=function(){},g.get_o_aviation=function(){e.get_o_aviation(function(t){g.aviation_items=t.items})},g.get_aviation_radar=function(){},g.get_elninos=function(){e.get_elninos(function(t){g.el_infos=t[0]}),e.get_option_files(function(t){g.ii=[a.image1="data: ;base64,"+t.elnino0.data,a.image2="data: ;base64,"+t.elnino1.data,a.image3="data: ;base64,"+t.elnino2.data],m(g.ii,".nino_i","El Nino")},"/file/search?category=elnino")},$("body").on("click",".swipebox",function(t){t.preventDefault();var e=$(this).attr("href");a.showImages(e)}),a.showImages=function(t){a.showModal("app/services/radar/radar_image_modal.html"),o(function(){var e=new Image;e.src=t;var a=$(".modal_img");a.html(e)},300)},a.showModal=function(t){n.fromTemplateUrl(t,{scope:a,animation:"slide-in-up"}).then(function(t){a.modal=t,a.modal.show()})},a.closeModal=function(){console.debug("modal",a.modal),a.modal.hide()},a.updateSlideStatus=function(t){var e=c.$getByHandle("scrollHandle"+t).getScrollPosition.zoom;d.enableSlide(e==a.zoomMin?!0:!1)},g.get_rainandtemp=function(){e.get_rainandtemp(function(t){for(g.key_list=t.items[0].para1.split("\r\n"),g.ir_list=t.items[0].para12.split("\r\n"),x=0;x<g.key_list.length;x++)g.key_list[x].trim();for(x=0;x<g.ir_list.length;x++)g.ir_list[x].trim();g.rt=t.items[0]}),e.get_option_files(function(t){g.rti=[a.image4="data: ;base64,"+t.rainandtemp0.data,a.image5="data: ;base64,"+t.rainandtemp1.data],m(g.rti,".rt_i","Rainfall - Temp")},"/file/search?category=rainandtemp")},g.get_drywet=function(){e.get_drywet(function(t){g.dw=t.items[0]}),e.get_option_files(function(t){g.dwi=[a.image6="data: ;base64,"+t.dryandwetspell0.data],m(g.dwi,".dw_i","Dry/Wet Outlook")},"/file/search?category=dryandwetspell")},g.agrotrini=function(){e.get_agrotrini(function(t){g.atrin=t.items[0]}),e.get_option_files(function(t){a.image_agro_trin=["data: ;base64,"+t.agrotrini0.data],m(a.image_agro_trin,".trin_i","Trinidad Agromet")},"/file/search?category=agrotrini"),e.get_agroData("summary",function(t){g.sum=t})},g.agrotbg=function(){e.get_agrotbg(function(t){g.atbg=t.items[0]}),e.get_option_files(function(t){a.image_agro_bago=["data: ;base64,"+t.agrotobago0.data],m(a.image_agro_bago,".bago_i","Tobago Agromet")},"/file/search?category=agrotobago"),e.get_agroDataTbg("summary",function(t){g.sumtbg=t})},n.fromTemplateUrl("app/services/elrtinfo_item.html",{scope:a,animation:"scale-in"}).then(function(t){a.elrtinfo_modal=t}),a.cinfo_open=function(t,i){switch(i){case"el":e.get_elnino(function(t){g.d_item=t.items[0]},t);break;case"rt":e.get_rainandtemp(function(t){g.d_item=t.items[0]},t);break;case"dw":e.get_drywet(function(t){g.d_item=t.items[0]},t)}a.elrtinfo_modal.show()},a.slideHasChanged_a=function(t){g.update_slide_a(t)},g.update_slide_a=function(t){titles=["Satellite","Radar","Weather Report","Forecast"],a.sub_title=titles[t]},a.slideHasChanged_c=function(t){g.update_slide_c(t)},g.update_slide_c=function(t){titles=["El Nino Update","Rainfall & Temp","Dry/Wet Outlook"],a.sub_title=titles[t]},a.slideHasChanged_m=function(t){g.update_slide_m(t)},g.update_slide_m=function(t){titles=[""],a.sub_title=titles[t]},a.slideHasChanged_t=function(t){g.update_slide_t(t)},g.update_slide_t=function(t){titles=["3-day Natinwide","3-day Tobago"],a.sub_title=titles[t]},a.slideHasChanged_ag=function(t){g.update_slide_ag(t)},g.update_slide_ag=function(t){titles=["Trinidad","Tobago"],a.sub_title=titles[t]},a.slide=function(t){c.scrollTop(),d.slide(t)},g.radars_150=function(){g.radars_150_list=t.all_of_cat(150)},g.radars_250=function(){g.radars_250_list=t.all_of_cat(250)},g.get_radar_400=function(){g.radars_400_list=t.all_of_cat(400)},g.sigmet=function(){e.get_sigmet(function(t){g.sig=t.items})}}]).controller("RadarDetailCtrl",["$scope","$stateParams","metApi","Radars","$http","$cordovaPush","$ionicPlatform","$rootScope","$ionicLoading","$state","$ionicBackdrop","$ionicModal","$ionicScrollDelegate","$ionicSlideBoxDelegate","$timeout",function(t,e,a,i,o,n,l,r,s,d,c,m,g,u,p){var f=this;t.close_loading=function(){s.hide()},t.get_radar_detail=function(){t.zoomMin=1,f.radar=i.get(e.id),a.get_radar(function(e){var a=new Image;a.src=e.data,t.image=e.data,a.style.maxWidth="100%";var i=$(".img_holder");i.html(a),i.find("img").wrap('<a href="'+t.image+'" class="swipebox2" title="'+f.radar.title+'"></a>')},f.radar.code),f.radar=i.get(e.id),$("body").on("click",".swipebox2",function(e){e.preventDefault(),t.showImages()})},t.reload_page=function(){t.get_radar_detail(e.id)},t.$on("loading:show",function(){s.show({template:' <ion-spinner class="light"></ion-spinner><br><button class="button button-light button-block" ng-click="close_loading()">Cancel</button>',scope:t})}),t.showImages=function(e){t.showModal("app/services/radar/radar_image_modal.html"),p(function(){var e=new Image;e.src=t.image;var a=$(".modal_img");a.html(e)},300)},t.showModal=function(e){$(".modal-backdrop").length>0&&$(".modal-backdrop:not(:last)").remove(),t.modal?t.modal.show():m.fromTemplateUrl(e,function(e){t.modal=e,t.modal.show()},{scope:t,animation:"slide-in-up"})},t.closeModal=function(){t.modal.hide().then(function(){$(".modal-backdrop").remove(),t.modal=null})},t.$on("$stateChangeStart",function(){t.modal.remove()}),t.updateSlideStatus=function(e){var a=g.$getByHandle("scrollHandle"+e).getScrollPosition.zoom;u.enableSlide(a==t.zoomMin?!0:!1)}}]).controller("AWSCtrl",["metApi","$scope","$timeout","$ionicModal","$ionicPlatform","$ionicPopup","$interval","$ionicBackdrop","$state","$route","$rootScope","$ionicLoading",function(t,e,a,i,o,n,l,r,s,d,m,g){e.ai=[],e.lat=10.511439,e.lng=-61.26756,e.mapCreated=function(t){e.map=t},e.centerOnMe=function(){e.map&&(g.show({content:"Getting current location...",showBackdrop:!1}),e.map.setCenter(new google.maps.LatLng(e.lat,e.lng)),g.hide())},e.closeModal=function(t){o.ready(function(){window.StatusBar&&StatusBar.styleLightContent()}),e.modal.hide()},e.$on("modal.hidden",function(){r.release()}),m.ace=function(a){o.ready(function(){window.StatusBar&&StatusBar.styleBlackTranslucent()}),e.title=a,t.get_aws(function(t){var a=t.items.length,i=t.items;for(z=0;z<a;z++)"Temperature"==i[z].item&&(e.ai[0]=i[z]),"Pressure"==i[z].item&&(e.ai[1]=i[z]),"Gust"==i[z].item&&(e.ai[2]=i[z]),"Precipitation"==i[z].item&&(e.ai[3]=i[z]),"Humidity"==i[z].item&&(e.ai[4]=i[z]),"Wind Direction"==i[z].item&&(e.ai[5]=i[z]),"Wind Speed"==i[z].item&&(e.ai[6]=i[z]);var o="";for(c=0;c<e.ai.length;c++)void 0!=e.ai[c]&&(o+='<div class="row"><div class="card wide"><div class="item item-divider">'+e.ai[c].item+'</div><div class="item item-text-wrap"><p>'+e.ai[c].value+"</p></div></div></div>");n.alert({title:e.title,template:o?o:'<p class="text-center">No data</p>',cssClass:"aws_popup",okText:"Close"})},a)}}]).directive("map",["$timeout","$compile","$ionicPopup","$ionicBackdrop","$ionicModal","$rootScope",function(t,e,a,o,n,l){return{restrict:"E",scope:{onCreate:"&"},link:function(e,a,o){function n(){e.lat=10.511439,e.lng=-61.26756;var o=[{city:"Piarco",desc:"Piarco  (BASE) AWS",lat:10.602912,"long":-61.33564},{city:"Brasso",desc:"Brasso Venado AWS",lat:10.399413,"long":-61.317268},{city:"Caroni",desc:"Caroni AWS",lat:10.606881,"long":-61.383883},{city:"Chatham",desc:"Chatham  AWS",lat:10.115793,"long":-61.74162},{city:"El Reposo",desc:"El Reposo AWS",lat:10.589908,"long":-61.114339},{city:"Penal",desc:"Penal AWS",lat:10.168662,"long":-61.43783},{city:"Centeno",desc:"Centeno AWS",lat:10.352226,"long":-61.192286}],n={center:new google.maps.LatLng(10.84584,-60.594896),zoom:9,mapTypeId:google.maps.MapTypeId.ROADMAP},r=new google.maps.Map(a[0],n);e.onCreate({map:r}),t(function(){r.setCenter(new google.maps.LatLng(e.lat,e.lng))},300),google.maps.event.addDomListener(a[0],"mousedown",function(t){return t.preventDefault(),!1}),e.markers=[];var s=function(t){var a=new google.maps.Marker({position:new google.maps.LatLng(t.lat,t["long"]),map:r,animation:google.maps.Animation.DROP,title:t.city});e.markers.push(a),a.addListener("click",function(){l.ace(this.title)})};for(i=0;i<o.length;i++)s(o[i])}"complete"===document.readyState?n():google.maps.event.addDomListener(window,"load",n)}}}]);